package KB.week05;

/* ================================================================
 *
 * Problem  : PGS - ë³´ë¬¼ì§€ë„
 * Author   : ê¹€ë¡œì•„
 * Date     : 2025-05-27
 *
 * ================================================================
 * ğŸ“Œ ë¬¸ì œ ë¶„ì„ ìš”ì•½
 * 1) í¬ê¸°: ì„¸ë¡œ m, ê°€ë¡œ n í¬ê¸°ì˜ ë³´ë¬¼ ì§€ë„
 * 2) ì¶œë°œì  (1,1)ì—ì„œ ë„ì°©ì  (m,n)ê¹Œì§€ ì´ë™í•´ì•¼ í•¨
 * 3) ìƒ/í•˜/ì¢Œ/ìš° í•œ ì¹¸ ì´ë™ ì‹œ ì‹œê°„ +1, í•¨ì •ì€ ì´ë™ ë¶ˆê°€
 * 4) 'ì‹ ë¹„í•œ ì‹ ë°œ' ì‚¬ìš© ì‹œ í•œ ë²ˆë§Œ ë‘ ì¹¸ ì´ë™ ê°€ëŠ¥, í•¨ì •ë„ ë„˜ì„ ìˆ˜ ìˆìŒ, ì‹œê°„ì€ ë™ì¼í•˜ê²Œ +1
 * 5) ëª©ì ì§€ê¹Œì§€ì˜ ìµœì†Œ ì‹œê°„ì„ êµ¬í•´ì•¼ í•¨
 *
 * # ì…ë ¥
 * - int m: ì„¸ë¡œ ê¸¸ì´ (í–‰)
 * - int n: ê°€ë¡œ ê¸¸ì´ (ì—´)
 * - int[][] hole: í•¨ì •ì˜ ì¢Œí‘œ ëª©ë¡
 *
 * # ì¶œë ¥
 * - ì¶œë°œì  (1,1) â†’ ë„ì°©ì  (m,n)ê¹Œì§€ ì´ë™í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ìµœì†Œ ì‹œê°„
 * - ë„ë‹¬í•  ìˆ˜ ì—†ë‹¤ë©´ -1 ë°˜í™˜
 *
 * ğŸ’» ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„
 * 1) BFSë¡œ ìµœë‹¨ ê±°ë¦¬ íƒìƒ‰
 *    â†’ ìƒíƒœ ì •ë³´: [í–‰, ì—´, ì‹ ë°œ ì‚¬ìš© ì—¬ë¶€, ì‹œê°„]
 * 2) visited[r][c][usedShoes] ë°°ì—´ë¡œ ìƒíƒœ ë°©ë¬¸ ì—¬ë¶€ ì²´í¬
 * 3) í•¨ì • ì—¬ë¶€ëŠ” isHole[r][c]ë¡œ ê´€ë¦¬
 * 4) ì¼ë°˜ ì´ë™(ìƒí•˜ì¢Œìš°): ë°©ë¬¸í•˜ì§€ ì•Šì•˜ê³  í•¨ì •ì´ ì•„ë‹ˆë©´ íì— ì‚½ì…
 * 5) ì‹ ë°œ ì í”„(2ì¹¸ ì´ë™): ì‹ ë°œì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ê³ , ëª©ì ì§€ê°€ ìœ íš¨í•˜ë©°, ë°©ë¬¸í•˜ì§€ ì•Šì•˜ìœ¼ë©´ íì— ì‚½ì…
 * 6) ë„ì°©ì ì— ë„ë‹¬ ì‹œ í˜„ì¬ ì‹œê°„ ë°˜í™˜
 * 7) íë¥¼ ëª¨ë‘ íƒìƒ‰í•´ë„ ë„ì°© ëª» í•˜ë©´ -1 ë°˜í™˜
 *
 * â° ì‹œê°„ë³µì¡ë„
 *  O(m * n * 2): ìœ„ì¹˜ (r,c)ë§ˆë‹¤ ì‹ ë°œ ì‚¬ìš© ì—¬ë¶€ 2ê°€ì§€ ìƒíƒœ
 *
 * ================================================================
 */

import java.util.ArrayDeque;
import java.util.Queue;

class Roa {
    // ìƒ, í•˜, ì¢Œ, ìš°
    static int[] dr = {1, -1, 0, 0};
    static int[] dc = {0, 0, -1, 1};

    // í–‰ : m, ì—´ : n -> solution ì•ˆì— ë³€ìˆ˜ ìˆœì„œ ë°”ê¿ˆ
    public int solution(int m, int n, int[][] hole) {
        Queue<int[]> q = new ArrayDeque<>(); // [r, c, usedShoes, time]
        boolean[][][] visited = new boolean[m + 1][n + 1][2]; // [r][c][usedShoes]
        boolean[][] isHole = new boolean[m + 1][n + 1]; // í•¨ì • ì—¬ë¶€

        // í•¨ì • ìœ„ì¹˜ í‘œì‹œ
        for (int[] h : hole) {
            isHole[h[0]][h[1]] = true;
        }

        // ì‹œì‘ ìœ„ì¹˜ í ì‚½ì…
        q.add(new int[]{1, 1, 0, 0});
        visited[1][1][0] = true;

        while (!q.isEmpty()) {
            int[] cur = q.remove();
            int r = cur[0];
            int c = cur[1];
            int usedShoes = cur[2];
            int time = cur[3];

            // ë„ì°© ì§€ì  ë„ë‹¬
            if (r == m && c == n) return time;

            // ì¼ë°˜ ì´ë™
            for (int i = 0; i < 4; i++) {
                int nr = r + dr[i];
                int nc = c + dc[i];

                if (0 < nr && nr <= m && 0 < nc && nc <= n &&
                        !visited[nr][nc][usedShoes] && !isHole[nr][nc]) {
                    visited[nr][nc][usedShoes] = true;
                    q.add(new int[]{nr, nc, usedShoes, time + 1});
                }
            }

            // ì í”„ ì´ë™ (ì‹ ë°œ í•œ ë²ˆë§Œ ì‚¬ìš© ê°€ëŠ¥)
            if (usedShoes == 0) {
                for (int i = 0; i < 4; i++) {
                    int nr = r + dr[i] * 2;
                    int nc = c + dc[i] * 2;

                    if (0 < nr && nr <= m && 0 < nc && nc <= n &&
                            !visited[nr][nc][1] && !isHole[nr][nc]) {
                        visited[nr][nc][1] = true;
                        q.add(new int[]{nr, nc, 1, time + 1});
                    }
                }
            }
        }

        // ë„ì°© ë¶ˆê°€ëŠ¥
        return -1;
    }
}
